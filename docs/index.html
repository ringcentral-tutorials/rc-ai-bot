<!DOCTYPE html><html><head><title>Building a RingCentral AI Chatbot- RingCentral Developer Tutorials</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" sizes="72x72" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="apple-touch-icon" sizes="114x114" href="https://developers.ringcentral.com/assets/images/favicon.ico?v=20161209-1544"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/jquery-ui@1.12.1/themes/base/all.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div class="dpw-header-container"><div class="dpw-header center-section"><div class="logo"><a href="https://developers.ringcentral.com" class="logo-link"></a></div><div class="nav-top-menus"></div><div class="dpw-login-section"><a href="https://developer.ringcentral.com/login.html#/">Sign in | Sign up</a></div></div></div><div id="viewsaurus" data-title="Building a RingCentral AI Chatbot"><div class="saurus-panes"><div class="saurus-panes-header"><a href="https://ringcentral.github.io/tutorials/" class="saurus-back-to-tutorials">Tutorials</a><span>&gt;</span><span>Building a RingCentral AI Chatbot</span></div><div class="saurus-prose"><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw icon-menu"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Welcome to RingCentral AI Chatbot tutorial! This tutorial will guide you through building a complete, public chatbot including user auth to third party services, subscribing to notifications, processing events and posting messages.

Click the &quot;Start&quot; button below to see how Viewsaurus works.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="RingCentral AI Bot" class="chapter"><div data-title="Overview" data-file="../README.md" data-highlight="1-6" class="step"><h2 id="overview">Overview</h2>
<ol>
<li>Prepare the development env</li>
<li>Test the bot</li>
<li>The bot workflow<ol>
<li>Bot auth</li>
<li>Subscribing for bot Events</li>
<li>Bot webhook get subscribed info</li>
<li>Bot post message</li>
<li>Build the user authorize URL</li>
<li>User authrize</li>
<li>Subscribing for user voicemail events</li>
<li>User webhook</li>
<li>Process the voicemail</li>
</ol>
</li>
<li>Practice<ol>
<li>Support unmonitor command</li>
<li>Write a custom command support</li>
<li>Just tell chat group how many new voicemail there</li>
<li>Write custom voicemail response</li>
</ol>
</li>
</ol>
</div><div data-title="Prerequisites" data-file="../README.md" data-highlight="8-35" class="step"><h2 id="prepare-the-development-env">Prepare the development env</h2>
<p>Follow the readme&#39;s instruction, create required App, set proper env, get the development env ready, add the bot to glip, ready to test the bot.</p>
<ul>
<li>1.Node.js &gt;= 8.10</li>
<li>2.Create a <strong>public</strong> bot app in <a href="https://developers.ringcentral.com">RingCentral developer site</a>, with permissions: <code>ReadContacts ReadMessages ReadPresence Contacts ReadAccounts SMS InternalMessages ReadCallLog ReadCallRecording SubscriptionWebhook Glip</code>. If you have trouble to create bot app, you can check this <a href="https://youtu.be/irmqUgKLwVw">youtube video of detailed walk through</a></li>
<li><p>3.Create a browser based <strong>public</strong> app in RingCentral developer site, with all permissions. If you have trouble to create user app, you can check this <a href="https://youtu.be/CgftrWkjduw">youtube video of detailed walk through</a></p>
</li>
<li><p>4.Prepare the development env</p>
</li>
</ul>
<pre><code>git clone git@github.com:ringcentral-tutorials/ringcentral-ai-bot.git
# or git clone https://github.com/ringcentral-tutorials/ringcentral-ai-bot.git
cd ringcentral-ai-bot
yarn

# create config
cp .sample.env .env
# then edit .env, specify credentials and other environment variables

## start local server
yarn dev

## start a ngrok proxy to local port
yarn proxy
# https://xxxxxx.ngrok.io ---&gt; http://localhost:7867
# you can check ngrok status from http://localhost:4040
</code></pre><ul>
<li>5.After started the ngrok server, you can set your ringcentral app&#39;s redirect URL to lamda&#39;s api gateway url, <code>https://xxxxxx.ngrok.io/bot-oauth</code> for bot app, <code>https://xxxxxx.ngrok.io/user-oauth</code> for user app, ngrok will proxy the request to your local server.</li>
<li>Goto your ringcentral developer site, in bot app&#39;s bot page, click <code>Add to glip</code>, do remember the bot name you specified, we will need it in next section.</li>
</ul>
</div><div data-title="Test the bot" data-file="../README.md" data-highlight="37-38" class="step"><h2 id="test-the-bot">Test the bot</h2>
<p>Login to <a href="https://glip-app.devtest.ringcentral.com">https://glip-app.devtest.ringcentral.com</a>, click bot&#39;s name from people list to start the chat, just follow the bot&#39;s instructions. It works, then we can see how it works. The chat would be like this:</p>
<p><img src="https://user-images.githubusercontent.com/1641949/48102986-77d93580-e268-11e8-8934-921ab7b8f21d.png" alt="chat content screeshot"></p>
</div><div data-title="Bot auth" data-file="../src/lamda/lib/bot-oauth.js" data-highlight="10-13" class="step"><h2 id="bot-authentication">Bot Authentication</h2>
<p>Since we set the redirect URL in bot app&#39;s setting page, when click the <code>Add to glip</code> Button, ringcentral will send request to the redirect URL, proxied by ngrok, finallly get to our local server.</p>
<p>We will use the code(<code>event.queryStringParameters.code</code>) provided by the request to do authorize, and store the fetched accessToken/user id etc to database.</p>
<p>Then we can subscribe to glip post and group event, so when user add bot to chat group, or post message in chat group, ringcentral will send notification to subscribed webhook.</p>
</div><div data-title="Subscribe to bot Events" data-file="../src/lamda/lib/store.js" data-highlight="94-118" class="step"><h2 id="subscribing-for-bot-events">Subscribing for bot Events</h2>
<p>The bot accesstoken will never expires, we set subscibe expire to a very long time(500000000ms, 15year+), set webhook to <code>/bot-webhook</code> so we can get data when use add bot to chat group, or post message in chat group.</p>
<p>Event filters are like this:</p>
<pre><code class="cm-s-monokai lang-js"><span class="cm-keyword">const</span> <span class="cm-variable">botEventFilters</span> <span class="cm-operator">=</span> () <span class="cm-operator">=&gt;</span> [
  <span class="cm-string">&#39;/restapi/v1.0/glip/posts&#39;</span>,
  <span class="cm-string">&#39;/restapi/v1.0/glip/groups&#39;</span>
]
</code></pre>
</div><div data-title="Bot webhook get subscribed info" data-file="../src/lamda/lib/bot-webhook.js" data-highlight="31-51" class="step"><h2 id="bot-webhook-get-subscribed-info">Bot webhook get subscribed info</h2>
<p>With the subscription, when user add bot to chat group, or post message in chat group, now our <code>/bot-webhook</code> will get the subscribed info, so we can respond accordingly, like post some message to guide user.</p>
</div><div data-title="Bot post message" data-file="../src/lamda/lib/store.js" data-highlight="144-149" class="step"><h2 id="bot-post-message">Bot post message</h2>
<p>To create a post use the Glip Create Post API:</p>
<p><code>/restapi/v1.0/glip/groups/{groupId}/posts</code></p>
<p>This requires sending the bot access token in the <code>Authorization</code> header as the <code>Bearer</code> token value.</p>
<p>The bot automatically handles both creating a new post and authorization.</p>
<p>More information on the API is available here:</p>
<ul>
<li><a href="https://developer.ringcentral.com/api-reference#Posts-createGlipGroupPost">Create Post API</a></li>
</ul>
</div><div data-title="Build the user authorize URL" data-file="../src/lamda/lib/store.js" data-highlight="192-197" class="step"><h2 id="build-the-user-authorize-url">Build the user authorize URL</h2>
<p>Why do we need user&#39;s authorization? Because we want to access user&#39;s VoiceMails. </p>
<p>After bot got joined chat group message, and guide user to <code>@</code> the bot, and command the bot by <code>@{BOTID} monitor</code>, bot sends the user authorize URL, let user to do the OAuth authorization first, that is why we need the user app in the beginning, bot could not get user info without authorization from user, it is by design.</p>
</div><div data-title="User authrize" data-file="../src/lamda/lib/user-oauth.js" data-highlight="9-21" class="step"><h2 id="user-authorize">User authorize</h2>
<p>When user click the authorize URL, and successfully authorized, OAuth flow will visit our server&#39;s <code>/user-oauth</code> with authrization code.</p>
<p>Similar to bot auth process, just use the auth code get access token, store user info, group info and token to database. The difference is user access token expire. We will see how to deal with this later.</p>
<p>With user&#39;s authorization, we can subscribe to user&#39;s voicemail message, so whenever new voicemail comes, ringcentral server notifies the bot server.</p>
</div><div data-title="Subscribe to user voicemail events" data-file="../src/lamda/lib/store.js" data-highlight="249-262" class="step"><h2 id="subscribe-to-user-voicemail-events">Subscribe to user voicemail events</h2>
<p>For user we subscribe these:</p>
<pre><code>[
  &#39;/restapi/v1.0/account/~/extension/~/message-store&#39;,
  &#39;/restapi/v1.0/subscription/~?threshold=59&amp;interval=15&#39;
]
</code></pre><p>1.Subscribe to <code>message-store</code> to get new voicemail notification.</p>
<p>2.Subscribe to <code>/restapi/v1.0/subscription/~?threshold=59&amp;interval=15</code> will setup a reminder, 59 seconds before subscribe expires, send notication request to supplied webhook url(<code>/user-webhook</code> in our case), if not susccessful, resend every 15 senconds, so we do token renew and subsribe renew when we got these notification request to make user token auto renew.</p>
<p>You can read more about reminder hook from <a href="https://github.com/ringcentral/ringcentral-api-docs/blob/master/docs/notifications_webhooks.md">https://github.com/ringcentral/ringcentral-api-docs/blob/master/docs/notifications_webhooks.md</a></p>
</div><div data-title="User webhook" data-file="../src/lamda/lib/user-webhook.js" data-highlight="10-47" class="step"><h2 id="user-webhook">User webhook</h2>
<p>Since we subscribe user voicemail events and reminder event, we must handle then accordingly.</p>
<p>That is where we could do different bot operations. We can practice later.</p>
</div></div><div data-title="Process the voicemail" data-file="../src/lamda/lib/voicemail-process.js" data-highlight="37-62" class="step"><h2 id="process-the-voicemail">Process the voicemail</h2>
<p>When you receive the new voicemail event, process the voicemail by transcribing it to text and then analyzing the text.</p>
<p>Since it is a external service, we put it in a seprate module: <a href="https://github.com/zxdong262/audio-analysis-service">https://github.com/zxdong262/audio-analysis-service</a></p>
<p>You may noticed by default we get a fake result for demo, if you want to use real google service to handle it, you should follow the instruction in <a href="https://github.com/ringcentral-tutorials/ringcentral-ai-bot#build-and-run-in-production-env">README#Build and Run in production env</a> to set your <code>GOOGLE_APPLICATION_CREDENTIALS</code> in <code>.env</code> then you will get real result.</p>
<p>That is the whole process. Hope you know how it works now. If so, let&#39;s do some practice, write some code.</p>
</div><div data-title="Support unmonitor command" data-file="../src/lamda/lib/bot-webhook.js" data-highlight="63-75" class="step"><h2 id="support-unmonitor-command">Support unmonitor command</h2>
<p>When you post <code>@botID unmonitor</code>, bot did not response, let&#39;s uncomment the code and restart the server to make it work.</p>
</div><div data-title="Write a custom command support" data-file="../src/lamda/lib/bot-webhook.js" data-highlight="92-93" class="step"><h2 id="add-a-custom-command">Add a custom command</h2>
<p>Now you can see how the bot command works, try write one yourself.</p>
</div><div data-title="Just tell chat group how many new voicemail there" data-file="../src/lamda/lib/user-webhook.js" data-highlight="24-40" class="step"><h2 id="only-show-number-of-new-voicemails">Only show number of new voicemails</h2>
<p>Let&#39;s replace the default voicemail process with simply telling user how many new voicemail there are by commenting out line 26-28, uncommenting line 31-40</p>
</div><div data-title="Write custom voicemail response" data-file="../src/lamda/lib/user-webhook.js" data-highlight="24-40" class="step"><h2 id="write-custom-voicemail-response">Write custom voicemail response</h2>
<p>The last practice!</p>
<p>Replace line26-28, write you own process function, send some custom response about new voice mail.</p>
<p>That&#39; i&#39;s all, have fun with the bot coding~</p>
</div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="../README.md" data-mode="markdown">IyBSaW5nQ2VudHJhbCBBSSBCb3QKClJpbmdDZW50cmFsIEdsaXAgdm9pY2VtYWlsIEFJIGJvdCBQT0MuCgojIyBGZWF0dXJlcwpSZWFkIEdsaXAgdXNlcidzIG5ldyB2b2ljZW1haWwsIHRyYW5zY3JpYmUgdGhlIHZvaWNlIHRvIHRleHQsIGFuYWx5emUgdGhlIHRleHQgd2l0aCBHb29nbGUgQUksIGFuZCBzZW5kIHRoZSByZXN1bHRzIHRvIHVzZXIgYXV0aHVyaXplZCBjaGF0IGdyb3VwLgoKIyMgUHJlcmVxdWlzaXRlcwoKLSBOb2RlLmpzID49IDguMTAKLSBDcmVhdGUgYSAqKnB1YmxpYyoqIGJvdCBhcHAgaW4gW1JpbmdDZW50cmFsIGRldmVsb3BlciBzaXRlXShodHRwczovL2RldmVsb3BlcnMucmluZ2NlbnRyYWwuY29tKSwgd2l0aCBwZXJtaXNzaW9uczogYFJlYWRDb250YWN0cyBSZWFkTWVzc2FnZXMgUmVhZFByZXNlbmNlIENvbnRhY3RzIFJlYWRBY2NvdW50cyBTTVMgSW50ZXJuYWxNZXNzYWdlcyBSZWFkQ2FsbExvZyBSZWFkQ2FsbFJlY29yZGluZyBTdWJzY3JpcHRpb25XZWJob29rIEdsaXBgCi0gQ3JlYXRlIGEgYnJvd3NlciBiYXNlZCAqKnB1YmxpYyoqIGFwcCBpbiBSaW5nQ2VudHJhbCBkZXZlbG9wZXIgc2l0ZSwgd2l0aCBhbGwgcGVybWlzc2lvbnMuCgojIyBQcmVwYXJlIHRoZSBkZXZlbG9wbWVudCBlbnYKCmBgYGJhc2gKZ2l0IGNsb25lIGdpdEBnaXRodWIuY29tOnJpbmdjZW50cmFsLXR1dG9yaWFscy9yaW5nY2VudHJhbC1haS1ib3QuZ2l0CiMgb3IgZ2l0IGNsb25lIGh0dHBzOi8vZ2l0aHViLmNvbS9yaW5nY2VudHJhbC10dXRvcmlhbHMvcmluZ2NlbnRyYWwtYWktYm90LmdpdApjZCByaW5nY2VudHJhbC1haS1ib3QKeWFybgoKIyBjcmVhdGUgY29uZmlnCmNwIC5zYW1wbGUuZW52IC5lbnYKIyB0aGVuIGVkaXQgLmVudiwgc3BlY2lmeSBjcmVkZW50aWFscyBhbmQgb3RoZXIgZW52aXJvbm1lbnQgdmFyaWFibGVzCgojIyBzdGFydCBsb2NhbCBzZXJ2ZXIKeWFybiBkZXYKCiMjIHN0YXJ0IGEgbmdyb2sgcHJveHkgdG8gbG9jYWwgcG9ydAp5YXJuIHByb3h5CiMgaHR0cHM6Ly94eHh4eHgubmdyb2suaW8gLS0tPiBodHRwOi8vbG9jYWxob3N0Ojc4NjcKIyB5b3UgY2FuIGNoZWNrIG5ncm9rIHN0YXR1cyBmcm9tIGh0dHA6Ly9sb2NhbGhvc3Q6NDA0MApgYGAKLSBBZnRlciBzdGFydGVkIHRoZSBuZ3JvayBzZXJ2ZXIsIHlvdSBjYW4gc2V0IHlvdXIgcmluZ2NlbnRyYWwgYXBwJ3MgcmVkaXJlY3QgVVJMIHRvIGxhbWRhJ3MgYXBpIGdhdGV3YXkgdXJsLCBgaHR0cHM6Ly94eHh4eHgubmdyb2suaW8vYm90LW9hdXRoYCBmb3IgYm90IGFwcCwgYGh0dHBzOi8veHh4eHh4Lm5ncm9rLmlvL3VzZXItb2F1dGhgIGZvciB1c2VyIGFwcCwgbmdyb2sgd2lsbCBwcm94eSB0aGUgcmVxdWVzdCB0byB5b3VyIGxvY2FsIHNlcnZlci4KLSBHb3RvIHlvdXIgcmluZ2NlbnRyYWwgZGV2ZWxvcGVyIHNpdGUsIGluIGJvdCBhcHAncyBib3QgcGFnZSwgY2xpY2sgYEFkZCB0byBnbGlwYCwgZG8gcmVtZW1iZXIgdGhlIGJvdCBuYW1lIHlvdSBzcGVjaWZpZWQsIHdlIHdpbGwgbmVlZCBpdCBpbiBuZXh0IHNlY3Rpb24uCgojIyBUZXN0IHRoZSBib3QKLSBMb2dpbiB0byBodHRwczovL2dsaXAtYXBwLmRldnRlc3QucmluZ2NlbnRyYWwuY29tLCBmaW5kIHRoZSBib3QgYnkgc2VhcmNoaW5nIGl0cyBuYW1lLiBUYWxrIHRvIHRoZSBib3QsIGZvbGxvdyB0aGUgaXRzIGluc3RydWN0aW9ucy4KCiMjIEJ1aWxkIGFuZCBSdW4gaW4gcHJvZHVjdGlvbiBlbnYKLSBJbiBsb2NhbCBkZXZlbG9wbWVudCwgYnkgZGVmYXVsdCB3ZSB1c2UgZmFrZSBkYXRhIHRvIHNpbXVsYXRlIHRoZSB2b2ljZW1haWwgdHJhbnNjcmlwdCBhbmQgYW5hbHlzaXMsIGluIHByb2R1Y3Rpb24gd2UgdXNlIHRoZSByZWFsIHRoaW5nLgotIFJlZ2lzdGVyIEdvb2dsZSBjbG91ZCBhY2NvdW50IGFuZCBzZXQgcGF5bWVudCBtZXRob2QsIGNyZWF0ZSBhbiBwcm9qZWN0IGFuZCBjcmVhdGUgYW4gY3JlZGVudGlhbCwgZG93bmxvYWQgeW91ciBjcmVkZW50aWFsIGpzb24uCi0gU2V0IGBHT09HTEVfQVBQTElDQVRJT05fQ1JFREVOVElBTFM9eW91ci9nb29nbGUvY3JlZGVudGlhbC9wYXRoYCBpbiBgLmVudmAKLSBSZXN0YXJ0IHNlcnZlcgoKYGBgYmFzaAojIGluc3RhbGwgcG0yIGZpcnN0IGlmIHlvdSB3YW5uYSB1c2UgcG0yCnlhcm4gZ2xvYmFsIGFkZCBwbTIKIyBvciBgbnBtIGkgLWcgcG0yYAoKIyBidWlsZAp5YXJuIGJ1aWxkCgojIHJ1biBwcm9kdWN0aW9uIHNlcnZlcgp5YXJuIHByb2Qtc2VydmVyCgojIHVzZSBwbTIKcG0yIHN0YXJ0IGJpbi9wbTIueW1sCmBgYAoKIyMgQnVpbGQgYW5kIGRlcGxveSB0byBBV1MgTGFtYmRhCgpBV1MgbGFtZGEgd2l0aCBhcGkgZ2F0ZSB3YXkgYW5kIGR5bmFtb2RiIHdvdWxkIGdpdmUgdXMgYSBmbGV4aWJsZSB3YXkgdG8gZGVwbG95IGJvdC4KCi0gKipPTkxZIHdvcmtzIGluIGxpbnV4KiosIEFXUyBsYW1kYSBpcyBpbiBsaW51eCB4NjQsIHNvbWUgZGVwZW5kZW5jaWVzIG5lZWQgdG8gYmUgcHJlYnVpbHQgYW5kIHVwbG9hZCB0byBsYW1kYSwgc28gbmVlZCB0aGUgYnVpbGQgcHJvY2VzcyBpbiBsaW51eCB4NjQsIHlvdSBjb3VsZCBkbyBpdCBpbiBjaSBvciBhbnkgbGludXggc2VydmVyL2Rlc3RvcCBlbnYuCgotIEdldCBhIGF3cyBhY2NvdW50LCBjcmVhdGUgYXdzX2FjY2Vzc19rZXlfaWQgYW5kIGF3c19zZWNyZXRfYWNjZXNzX2tleSwgcHV0IGl0IGluIGB+Ly5hd3MvY3JlZGVudGlhbHNgLCBsaWtlIHRoaXM6CmBgYGJhc2gKW2RlZmF1bHRdCmF3c19hY2Nlc3Nfa2V5X2lkID0gPHlvdXIgYXdzX2FjY2Vzc19rZXlfaWQ+CmF3c19zZWNyZXRfYWNjZXNzX2tleSA9IDx5b3VyIGF3c19zZWNyZXRfYWNjZXNzX2tleT4KYGBgCnJlZmVyIHRvIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9nZW5lcmFsL2xhdGVzdC9nci9hd3Mtc2VjdXJpdHktY3JlZGVudGlhbHMuaHRtbC4KCgpgYGBiYXNoCmNwIGxhbWRhL3NlcnZlcmxlc3Muc2FtcGxlLnltbCBsYW1kYS9zZXJ2ZXJsZXNzLnltbApgYGAKRWRpdCBgbGFtZGEvc2VydmVybGVzcy55bWxgLCBtYWtlIHN1cmUgeW91IHNldCBwcm9wZXIgbmFtZSBhbmQgcmVxdWlyZWQgZW52CmBgYHltbAojIHlvdSBjYW4gZGVmaW5lIHNlcnZpY2Ugd2lkZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgaGVyZQogIGVudmlyb25tZW50OgogICAgTk9ERV9FTlY6IHByb2R1Y3Rpb24KICAgICMgcmluZ2NlbnRyYWwgYXBwcwoKICAgICMjIGJvdHMKICAgIFJJTkdDRU5UUkFMX0JPVF9DTElFTlRfSUQ6CiAgICBSSU5HQ0VOVFJBTF9CT1RfQ0xJRU5UX1NFQ1JFVDoKCiAgICAjIyB1c2VyCiAgICBSSU5HQ0VOVFJBTF9VU0VSX0NMSUVOVF9JRDoKICAgIFJJTkdDRU5UUkFMX1VTRVJfQ0xJRU5UX1NFQ1JFVDoKCiAgICAjIyBjb21tb24KICAgIFJJTkdDRU5UUkFMX1NFUlZFUjogaHR0cHM6Ly9wbGF0Zm9ybS5kZXZ0ZXN0LnJpbmdjZW50cmFsLmNvbQogICAgUklOR0NFTlRSQUxfQk9UX1NFUlZFUjogaHR0cHM6Ly94eHh4LmV4ZWN1dGUtYXBpLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL2RlZmF1bHQvcG9jLXlvdXItYm90LW5hbWUtZGV2LWJvdAoKICAgICMjIGZvciBnb29nbGUgY2xvdWQgYXBpIGNyZW5kZW50aWFsIHBhdGgKICAgIEdPT0dMRV9BUFBMSUNBVElPTl9DUkVERU5USUFMUzogcGF0aC90by9nb29nbGUtY3JlZGVudGlhbC5qc29uCgogICAgIyBkYgogICAgREJfVFlQRTogZHluYW1vZGIKICAgIERZTkFNT0RCX1RBQkxFX1BSRUZJWDogcmNfYWlfYm90MQogICAgRFlOQU1PREJfUkVHSU9OOiB1cy1lYXN0LTEKCmBgYAoKRGVwbG95IHRvIGF3cyBsYW1kYSB3aXRoIGBucG0gcnVuIGRlcGxveWAKYGBgYmFzaAojIG1ha2Ugc3VyZSB5b3UgaGF2ZSB5YXJuLCBjb3VsZCB1c2UgYG5wbSBpIC1nIHlhcm4gdG8gaW5zdGFsbGAKIyB0aGVuIHJ1biB0aGlzIGNtZCB0byBkZXBsb3kgdG8gYXdzIGxhbWRhLCBmdWxsIGJ1aWxkLCBtYXkgdGFrZSBtb3JlIHRpbWUKbnBtIHJ1biBkZXBsb3kKCiMjIHdhdGNoIGxhbWRhIHNlcnZlciBsb2cKbnBtIHJ1biB3YXRjaAoKIyMgdXBkYXRlIGZ1bmN0aW9uCm5wbSBydW4gdXBkYXRlCgojIyB1cGRhdGUgd2l0aG91dCBidWlsZCwgZmFzdCB1cGRhdGUsIG5vIHJlYnVpbGQKbnBtIHJ1biB1CmBgYAotIENyZWF0ZSBhcGkgZ2F0ZXdheSBmb3IgeW91ciBsYW1kYSBmdW5jdGlvbiwgc2hhcGUgYXMgYGh0dHBzOi8veHh4eC5leGVjdXRlLWFwaS51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9kZWZhdWx0L3BvYy15b3VyLWJvdC1uYW1lLWRldi1ib3Qve2FjdGlvbit9YAotIE1ha2Ugc3VyZSB5b3VyIGxhbWRhIGZ1bmN0aW9uIHJvbGUgaGFzIHBlcm1pc3Npb24gdG8gcmVhZC93cml0ZSBkeW5hbW9kYihTZXQgdGhpcyBmcm9tIGF3cyBJQU0gcm9sZXMsIGNvdWxkIHNpbXBseSBhdHRhY2ggYEFtYXpvbkR5bmFtb0RCRnVsbEFjY2Vzc2AgcG9saWN5IHRvIGxhbWRhIGZ1bmN0aW9uJ3Mgcm9sZSkKLSBNYWtlIHN1cmUgeW91ciBsYW1kYSBmdW5jdGlvbidzIHRpbWVvdXQgbW9yZSB0aGFuIDUgbWludXRlcwotIERvIG5vdCBmb3JnZXQgdG8gc2V0IHlvdXIgcmluZ2NlbnRyYWwgYXBwJ3MgcmVkaXJlY3QgVVJMIHRvIGxhbWRhJ3MgYXBpIGdhdGV3YXkgdXJsLCBgaHR0cHM6Ly94eHh4LmV4ZWN1dGUtYXBpLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL2RlZmF1bHQvcG9jLXlvdXItYm90LW5hbWUtZGV2LWJvdC9ib3Qtb2F1dGhgIGZvciBib3QgYXBwLCBgaHR0cHM6Ly94eHh4LmV4ZWN1dGUtYXBpLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL2RlZmF1bHQvcG9jLXlvdXItYm90LW5hbWUtZGV2LWJvdC91c2VyLW9hdXRoYCBmb3IgdXNlciBhcHAuCgojIyBFZGl0IHR1dG9yaWFsClRoaXMgcmVwbyBhbHNvIHNlcnZlcyBhcyBhIHR1dG9yaWFsIGluIGh0dHBzOi8vcmluZ2NlbnRyYWwtdHV0b3JpYWxzLmdpdGh1Yi5pby9yaW5nY2VudHJhbC1haS1ib3QuCmBgYAojIGluc3RhbGwgZGVwcwp5YXJuCgojIHN0YXJ0IGxvY2FsIGRvY3Mgc2VydmVyCnlhcm4gZG9jcwpgYGAKVGhlbiB2aXNpdCBodHRwOi8vbG9jYWxob3N0Ojg4ODggdG8gY2hlY2sgdGhlIHR1dG9yaWFsCgpZb3UgY2FuIGVkaXQgYGRvY3MvdHV0b3JpYWwvaW5kZXguamFkZWAsIGRvY3Mgd2lsbCBhdXRvIHVwZGF0ZSBgZG9jcy9pbmRleC5odG1sYCwgcmVmcmVzaCBodHRwOi8vbG9jYWxob3N0Ojg4ODggdG8gc2VlIHRoZSBjaGFuZ2UuCgojIyBDcmVkaXRzCi0gVGhlIGNvbmNlcHQgb2YgdGhpcyBib3QgaXMgZGVzaWduZWQgYnkgW0Bncm9raWZ5XShodHRwczovL2dpdGh1Yi5jb20vZ3Jva2lmeSkKLSBbQHR5bGVybG9uZ10oaHR0cHM6Ly9naXRodWIuY29tL3R5bGVybG9uZykgd3JvdGUgdGhlIHRva2VuIG1hbmFnZW1lbnQgbG9naWMKLSBbQHp4ZG9uZzI2Ml0oaHR0cHM6Ly9naXRodWIuY29tL3p4ZG9uZzI2MikgaW1wbGVtZW50ZWQgZXZlcnl0aGluZyBlbHNlCgojIyBEb2N1bWVudHMgJiBSZWZlcmVuY2UKLSBodHRwczovL2RldmVsb3Blci5yaW5nY2VudHJhbC5jb20vbGVnYWN5LWFwaS1yZWZlcmVuY2UvaW5kZXguaHRtbCMhI092ZXJ2aWV3Lmh0bWwKLSBodHRwczovL3JpbmdjZW50cmFsLWFwaS1kb2NzLnJlYWR0aGVkb2NzLmlvL2VuL2xhdGVzdC9nbGlwX2JvdHMvCi0gaHR0cHM6Ly9naXRodWIuY29tL2dyb2tpZnkvcmluZ2NlbnRyYWwtcG9sbGluZy1hbmQtc3luY2luZwotIGh0dHBzOi8vZ2l0aHViLmNvbS9yaW5nY2VudHJhbC9yaW5nY2VudHJhbC1qcwotIGh0dHBzOi8vZ2l0aHViLmNvbS90eWxlcmxvbmcvcmluZ2NlbnRyYWwtanMtY29uY2lzZQotIGh0dHBzOi8vZ2l0aHViLmNvbS9ncm9raWZ5L2dyb3VwYm90Ci0gaHR0cHM6Ly9naXRodWIuY29tL3R5bGVybG9uZy9zdWJ4Ci0gaHR0cHM6Ly9naXRodWIuY29tL3p4ZG9uZzI2Mi9hdWRpby1hbmFseXNpcy1zZXJ2aWNlIChWb2ljZSB0cmFuc2NyaXB0L2FuYWx5c2lzIHJlbGF0ZWQgZXh0ZXJuYWwgc2VydmljZSkKCiMjIExpY2Vuc2UKCk1JVAo=</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/bot-oauth.js" data-mode="javascript">LyoqCiAqIHVzZXIgb2F1dGggYnkgdHlsZXIKICovCgppbXBvcnQge3Jlc3VsdH0gZnJvbSAnLi9jb21tb24nCgppbXBvcnQge0JvdH0gZnJvbSAnLi9zdG9yZScKCmV4cG9ydCBkZWZhdWx0IGFzeW5jIChldmVudCkgPT4gewogIGNvbnN0IGJvdCA9IG5ldyBCb3QoKQogIGF3YWl0IGJvdC5hdXRob3JpemUoZXZlbnQucXVlcnlTdHJpbmdQYXJhbWV0ZXJzLmNvZGUpCiAgYXdhaXQgYm90LnJlbmV3V2ViSG9va3MoKQogIHJldHVybiByZXN1bHQoJ0JvdCBhZGRlZCcpCn0K</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/store.js" data-mode="javascript">CmltcG9ydCBTdWJ4IGZyb20gJ3N1YngnCmltcG9ydCBSaW5nQ2VudHJhbCBmcm9tICdyaW5nY2VudHJhbC1qcy1jb25jaXNlJwppbXBvcnQge3Byb2Nlc3NNYWlsfSBmcm9tICcuL3ZvaWNlbWFpbC1wcm9jZXNzJwppbXBvcnQgZGIgZnJvbSAnLi9kYicKaW1wb3J0IHsKICBsb2csIHRhYmxlcywgcmVzdWx0Rm9ybWF0dGVyLCBkZWJ1ZywKICBzdWJzY3JpYmVJbnRlcnZhbCwgZXhwaXJlc0luLCBoYW5kbGVSQ0Vycm9yCn0gZnJvbSAnLi9jb21tb24nCmltcG9ydCBfIGZyb20gJ2xvZGFzaCcKCmNvbnN0IGJvdEV2ZW50RmlsdGVycyA9ICgpID0+IFsKICAnL3Jlc3RhcGkvdjEuMC9nbGlwL3Bvc3RzJywKICAnL3Jlc3RhcGkvdjEuMC9nbGlwL2dyb3VwcycKXQoKY29uc3QgdXNlckV2ZW50RmlsdGVycyA9ICgpID0+IFsKICAnL3Jlc3RhcGkvdjEuMC9hY2NvdW50L34vZXh0ZW5zaW9uL34vbWVzc2FnZS1zdG9yZScsCiAgc3Vic2NyaWJlSW50ZXJ2YWwoKQpdCgpmdW5jdGlvbiBjYXBpdGFsaXplRmlyc3RMZXR0ZXIoc3RyaW5nKSB7CiAgcmV0dXJuIHN0cmluZy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0cmluZy5zbGljZSgxKQp9CgovL2J1aWxkIHN0b3JlIGZ1bmN0aW9ucwpmdW5jdGlvbiBnZXRTdG9yZSAoKSB7CiAgbGV0IHN1YnhlZCA9IFsndXNlcicsICdib3QnXQogIHJldHVybiB0YWJsZXMucmVkdWNlKChwcmV2LCB0YWJsZSkgPT4gewogICAgbGV0IGNhcCA9IGNhcGl0YWxpemVGaXJzdExldHRlcih0YWJsZSkKICAgIHJldHVybiB7CiAgICAgIC4uLnByZXYsCiAgICAgIFtgZ2V0JHtjYXB9YF06IGFzeW5jIGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgbGV0IGl0ZW0gPSB7fQogICAgICAgIGl0ZW0gPSBhd2FpdCBkYi5kYkFjdGlvbih0YWJsZSwgJ2dldCcsIHtpZH0pCiAgICAgICAgaWYgKCFzdWJ4ZWQuaW5jbHVkZXModGFibGUpKSB7CiAgICAgICAgICByZXR1cm4gaXRlbQogICAgICAgIH0KICAgICAgICBpZiAoIWl0ZW0pIHsKICAgICAgICAgIHJldHVybiBpdGVtCiAgICAgICAgfQogICAgICAgIHJldHVybiBjcmVhdGUoaXRlbSwgdGFibGUpCiAgICAgIH0sCiAgICAgIFtgcmVtb3ZlJHtjYXB9YF06IGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgcmV0dXJuIGRiLmRiQWN0aW9uKHRhYmxlLCAncmVtb3ZlJywge2lkfSkKICAgICAgfSwKICAgICAgW2BhZGQke2NhcH1gXTogZnVuY3Rpb24oaXRlbSkgewogICAgICAgIHJldHVybiBkYi5kYkFjdGlvbih0YWJsZSwgJ2FkZCcsIGl0ZW0pCiAgICAgIH0KICAgIH0KICB9LCB7fSkKfQoKCmV4cG9ydCBjb25zdCBzdG9yZSA9IGdldFN0b3JlKCkKCi8vIEJvdApleHBvcnQgY29uc3QgQm90ID0gbmV3IFN1YngoewogIGdldCByYyAoKSB7CiAgICBjb25zdCByYyA9IG5ldyBSaW5nQ2VudHJhbCgKICAgICAgcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfQk9UX0NMSUVOVF9JRCwKICAgICAgcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfQk9UX0NMSUVOVF9TRUNSRVQsCiAgICAgIHByb2Nlc3MuZW52LlJJTkdDRU5UUkFMX1NFUlZFUgogICAgKQogICAgcmMudG9rZW4odGhpcy50b2tlbikKICAgIHJldHVybiByYwogIH0sCiAgYXN5bmMgd3JpdGVUb0RiKGl0ZW0pIHsKICAgIGlmIChpdGVtKSB7CiAgICAgIGF3YWl0IGRiLmRiQWN0aW9uKCdib3QnLCAnYWRkJywgaXRlbSkKICAgIH0gZWxzZSB7CiAgICAgIGF3YWl0IGRiLmRiQWN0aW9uKCdib3QnLCAndXBkYXRlJywgewogICAgICAgIGlkOiB0aGlzLmlkLAogICAgICAgIHVwZGF0ZTogewogICAgICAgICAgdG9rZW46IHRoaXMudG9rZW4KICAgICAgICB9CiAgICAgIH0pCiAgICB9CiAgfSwKICBhc3luYyBhdXRob3JpemUgKGNvZGUpIHsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRoaXMucmMuYXV0aG9yaXplKHsgY29kZSwgcmVkaXJlY3RVcmk6IHByb2Nlc3MuZW52LlJJTkdDRU5UUkFMX0JPVF9TRVJWRVIgKyAnL2JvdC1vYXV0aCcgfSkKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcignQm90IGF1dGhvcml6ZScsIGUpCiAgICB9CiAgICBsZXQgdG9rZW4gPSB0aGlzLnJjLnRva2VuKCkKICAgIGxldCBpZCA9IHRva2VuLm93bmVyX2lkCiAgICB0aGlzLnRva2VuID0gdG9rZW4KICAgIHRoaXMuaWQgPSBpZAogICAgYXdhaXQgdGhpcy53cml0ZVRvRGIoewogICAgICBpZCwKICAgICAgdG9rZW4KICAgIH0pCiAgfSwKICBhc3luYyBzZXR1cFdlYkhvb2sgKCkgewogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5yYy5wb3N0KCcvcmVzdGFwaS92MS4wL3N1YnNjcmlwdGlvbicsIHsKICAgICAgICBldmVudEZpbHRlcnM6IGJvdEV2ZW50RmlsdGVycygpLAogICAgICAgIGV4cGlyZXNJbjogNTAwMDAwMDAwLAogICAgICAgIGRlbGl2ZXJ5TW9kZTogewogICAgICAgICAgdHJhbnNwb3J0VHlwZTogJ1dlYkhvb2snLAogICAgICAgICAgYWRkcmVzczogcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfQk9UX1NFUlZFUiArICcvYm90LXdlYmhvb2snCiAgICAgICAgfQogICAgICB9KQogICAgfSBjYXRjaCAoZSkgewogICAgICBsZXQgZGF0YSA9IF8uZ2V0KGUsICdyZXNwb25zZS5kYXRhJykgfHwge30KICAgICAgbGV0IHN0ciA9IEpTT04uc3RyaW5naWZ5KGRhdGEpCiAgICAgIGlmIChzdHIuaW5jbHVkZXMoJ1NVQi00MDYnKSkgewogICAgICAgIGxvZygnYm90IHN1YnNjcmliZSBmYWlsLCB3aWxsIGRvIHN1YnNjcmliZSBvbmUgbWludXRlcyBsYXRlcicpCiAgICAgICAgc2V0VGltZW91dCgKICAgICAgICAgICgpID0+IHRoaXMucmVuZXdXZWJIb29rcygpLAogICAgICAgICAgNjAgKiAxMDAwCiAgICAgICAgKQogICAgICB9IGVsc2UgewogICAgICAgIGhhbmRsZVJDRXJyb3IoJ0JvdCBzZXR1cFdlYkhvb2snLCBlKQogICAgICAgIHRocm93IGUKICAgICAgfQogICAgfQogIH0sCiAgYXN5bmMgcmVuZXdXZWJIb29rcyAoKSB7CiAgICB0cnkgewogICAgICBjb25zdCByID0gYXdhaXQgdGhpcy5yYy5nZXQoJy9yZXN0YXBpL3YxLjAvc3Vic2NyaXB0aW9uJykKICAgICAgbGV0IGZpbHRlcmVkID0gci5kYXRhLnJlY29yZHMuZmlsdGVyKAogICAgICAgIHIgPT4gewogICAgICAgICAgcmV0dXJuIHIuZGVsaXZlcnlNb2RlLmFkZHJlc3MgPT09IHByb2Nlc3MuZW52LlJJTkdDRU5UUkFMX0JPVF9TRVJWRVIgKyAnL2JvdC13ZWJob29rJwogICAgICAgIH0KICAgICAgKQogICAgICBkZWJ1ZygnYm90IHN1YnMgbGlzdCcsIGZpbHRlcmVkLm1hcChnID0+IGcuaWQpLmpvaW4oJywnKSkKICAgICAgYXdhaXQgdGhpcy5zZXR1cFdlYkhvb2soKQogICAgICBmb3IgKGxldCBzdWIgb2YgZmlsdGVyZWQpIHsKICAgICAgICBhd2FpdCB0aGlzLmRlbFN1YnNjcmlwdGlvbihzdWIuaWQpCiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcignYm90IHJlbmV3V2ViSG9va3MnLCBlKQogICAgfQogIH0sCiAgYXN5bmMgZGVsU3Vic2NyaXB0aW9uIChpZCkgewogICAgZGVidWcoJ2RlbCBib3Qgc3ViIGlkOicsIGlkKQogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5yYy5kZWxldGUoYC9yZXN0YXBpL3YxLjAvc3Vic2NyaXB0aW9uLyR7aWR9YCkKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcignYm90IGRlbFN1YnNjcmlwdGlvbicsIGUpCiAgICB9CiAgfSwKICBhc3luYyBzZW5kTWVzc2FnZSAoZ3JvdXBJZCwgbWVzc2FnZU9iaikgewogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5yYy5wb3N0KGAvcmVzdGFwaS92MS4wL2dsaXAvZ3JvdXBzLyR7Z3JvdXBJZH0vcG9zdHNgLCBtZXNzYWdlT2JqKQogICAgfSBjYXRjaCAoZSkgewogICAgICBoYW5kbGVSQ0Vycm9yKCdCb3Qgc2VuZE1lc3NhZ2UnLCBlKQogICAgfQogIH0sCiAgYXN5bmMgdmFsaWRhdGUgKCkgewogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5yYy5nZXQoJy9yZXN0YXBpL3YxLjAvYWNjb3VudC9+L2V4dGVuc2lvbi9+JykKICAgICAgcmV0dXJuIHRydWUKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcignQm90IHZhbGlkYXRlJywgZSkKICAgICAgY29uc3QgZXJyb3JDb2RlID0gXy5nZXQoZSwgJ3Jlc3BvbnNlLmRhdGEuZXJyb3JDb2RlJykKICAgICAgaWYgKGVycm9yQ29kZSA9PT0gJ09BVS0yMzInIHx8IGVycm9yQ29kZSA9PT0gJ0NNTi00MDUnKSB7CiAgICAgICAgYXdhaXQgc3RvcmUucmVtb3ZlQm90W3RoaXMuaWRdCiAgICAgICAgbG9nKGBCb3QgdXNlciAke3RoaXMuaWR9IGhhcyBiZWVuIGRlbGV0ZWRgKQogICAgICAgIHJldHVybiBmYWxzZQogICAgICB9CiAgICB9CiAgfQp9KQoKLy8gVXNlcgpleHBvcnQgY29uc3QgVXNlciA9IG5ldyBTdWJ4KHsKICBncm91cHM6IHt9LAogIGdldCByYyAoKSB7CiAgICBjb25zdCByYyA9IG5ldyBSaW5nQ2VudHJhbCgKICAgICAgcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfVVNFUl9DTElFTlRfSUQsCiAgICAgIHByb2Nlc3MuZW52LlJJTkdDRU5UUkFMX1VTRVJfQ0xJRU5UX1NFQ1JFVCwKICAgICAgcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfU0VSVkVSCiAgICApCiAgICByYy50b2tlbih0aGlzLnRva2VuKQogICAgcmV0dXJuIHJjCiAgfSwKICBhc3luYyB3cml0ZVRvRGIoaXRlbSkgewogICAgaWYgKGl0ZW0pIHsKICAgICAgYXdhaXQgZGIuZGJBY3Rpb24oJ3VzZXInLCAnYWRkJywgaXRlbSkKICAgIH0gZWxzZSB7CiAgICAgIGF3YWl0IGRiLmRiQWN0aW9uKCd1c2VyJywgJ3VwZGF0ZScsIHsKICAgICAgICBpZDogdGhpcy5pZCwKICAgICAgICB1cGRhdGU6IHsKICAgICAgICAgIHRva2VuOiB0aGlzLnRva2VuLAogICAgICAgICAgZ3JvdXBzOiB0aGlzLmdyb3VwcwogICAgICAgIH0KICAgICAgfSkKICAgIH0KICB9LAogIGF1dGhvcml6ZVVyaSAoZ3JvdXBJZCwgYm90SWQpIHsKICAgIHJldHVybiB0aGlzLnJjLmF1dGhvcml6ZVVyaShwcm9jZXNzLmVudi5SSU5HQ0VOVFJBTF9CT1RfU0VSVkVSICsgJy91c2VyLW9hdXRoJywgewogICAgICBzdGF0ZTogZ3JvdXBJZCArICc6JyArIGJvdElkLAogICAgICByZXNwb25zZVR5cGU6ICdjb2RlJwogICAgfSkKICB9LAogIGFzeW5jIGF1dGhvcml6ZSAoY29kZSkgewogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5yYy5hdXRob3JpemUoeyBjb2RlLCByZWRpcmVjdFVyaTogcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfQk9UX1NFUlZFUiArICcvdXNlci1vYXV0aCcgfSkKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcignVXNlciBhdXRob3JpemUnLCBlKQogICAgfQogICAgbGV0IHRva2VuID0gdGhpcy5yYy50b2tlbigpCiAgICBsZXQgaWQgPSB0b2tlbi5vd25lcl9pZAogICAgdGhpcy50b2tlbiA9IHRva2VuCiAgICB0aGlzLmlkID0gaWQKICAgIGF3YWl0IHRoaXMud3JpdGVUb0RiKHsKICAgICAgaWQsCiAgICAgIHRva2VuLAogICAgICBncm91cHM6IHt9CiAgICB9KQogIH0sCiAgYXN5bmMgcmVmcmVzaCAoKSB7CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLnJjLnJlZnJlc2goKQogICAgICB0aGlzLnRva2VuID0gdGhpcy5yYy50b2tlbigpCiAgICAgIGF3YWl0IHRoaXMud3JpdGVUb0RiKCkKICAgIH0gY2F0Y2goZSkgewogICAgICBoYW5kbGVSQ0Vycm9yKCdVc2VyIHJlZnJlc2ggdG9rZW4nLCBlKQogICAgICBhd2FpdCBzdG9yZS5yZW1vdmVVc2VyKHRoaXMuaWQpCiAgICAgIGxvZyhgVXNlciAke3RoaXMudG9rZW4ub3duZXJfaWR9IHJlZnJlc2ggdG9rZW4gaGFzIGV4cGlyZWRgKQogICAgfQogIH0sCiAgYXN5bmMgcmVuZXdXZWJIb29rcyAoKSB7CiAgICB0cnkgewogICAgICBjb25zdCByID0gYXdhaXQgdGhpcy5yYy5nZXQoJy9yZXN0YXBpL3YxLjAvc3Vic2NyaXB0aW9uJykKICAgICAgbGV0IGZpbHRlcmVkID0gci5kYXRhLnJlY29yZHMuZmlsdGVyKAogICAgICAgIHIgPT4gewogICAgICAgICAgcmV0dXJuIHIuZGVsaXZlcnlNb2RlLmFkZHJlc3MgPT09IHByb2Nlc3MuZW52LlJJTkdDRU5UUkFMX0JPVF9TRVJWRVIgKyAnL3VzZXItd2ViaG9vaycKICAgICAgICB9CiAgICAgICkKICAgICAgbG9nKCd1c2VyIHN1YnMgbGlzdCcsIGZpbHRlcmVkLm1hcChnID0+IGcuaWQpLmpvaW4oJywnKSkKICAgICAgYXdhaXQgdGhpcy5zZXR1cFdlYkhvb2soKQogICAgICBmb3IgKGxldCBzdWIgb2YgZmlsdGVyZWQpIHsKICAgICAgICBhd2FpdCB0aGlzLmRlbFN1YnNjcmlwdGlvbihzdWIuaWQpCiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcigndXNlciByZW5ld1dlYkhvb2tzJywgZSkKICAgIH0KICB9LAogIGFzeW5jIGRlbFN1YnNjcmlwdGlvbiAoaWQpIHsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRoaXMucmMuZGVsZXRlKGAvcmVzdGFwaS92MS4wL3N1YnNjcmlwdGlvbi8ke2lkfWApCiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGhhbmRsZVJDRXJyb3IoYHVzZXIgZGVsU3Vic2NyaXB0aW9uICR7aWR9YCwgZSkKICAgIH0KICB9LAogIGFzeW5jIHNldHVwV2ViSG9vayAoKSB7IC8vIHNldHVwIFdlYkhvb2sgZm9yIHZvaWNlbWFpbAogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5yYy5wb3N0KCcvcmVzdGFwaS92MS4wL3N1YnNjcmlwdGlvbicsIHsKICAgICAgICBldmVudEZpbHRlcnM6IHVzZXJFdmVudEZpbHRlcnMoKSwKICAgICAgICBleHBpcmVzSW46IGV4cGlyZXNJbigpLAogICAgICAgIGRlbGl2ZXJ5TW9kZTogewogICAgICAgICAgdHJhbnNwb3J0VHlwZTogJ1dlYkhvb2snLAogICAgICAgICAgYWRkcmVzczogcHJvY2Vzcy5lbnYuUklOR0NFTlRSQUxfQk9UX1NFUlZFUiArICcvdXNlci13ZWJob29rJwogICAgICAgIH0KICAgICAgfSkKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlUkNFcnJvcignVXNlciBzZXR1cFdlYkhvb2snLCBlKQogICAgfQogIH0sCiAgYXN5bmMgcmVtb3ZlR3JvdXAoaWQpIHsKICAgIGRlbGV0ZSB0aGlzLmdyb3Vwc1tpZF0KICAgIGF3YWl0IHRoaXMud3JpdGVUb0RiKCkKICB9LAogIGFzeW5jIGFkZEdyb3VwIChncm91cElkLCBib3RJZCkgewogICAgY29uc3QgaGFzTm9Hcm91cCA9IE9iamVjdC5rZXlzKHRoaXMuZ3JvdXBzKS5sZW5ndGggPT09IDAKICAgIHRoaXMuZ3JvdXBzW2dyb3VwSWRdID0gYm90SWQKICAgIGF3YWl0IHRoaXMud3JpdGVUb0RiKCkKICAgIGlmIChoYXNOb0dyb3VwKSB7CiAgICAgIGF3YWl0IHRoaXMuc2V0dXBXZWJIb29rKCkKICAgIH0KICB9LAogIGFzeW5jIGdldFZvaWNlTWFpbHMgKGNvdW50KSB7CiAgICBjb25zdCByID0gYXdhaXQgdGhpcy5yYy5nZXQoJy9yZXN0YXBpL3YxLjAvYWNjb3VudC9+L2V4dGVuc2lvbi9+L21lc3NhZ2Utc3RvcmUnLCB7CiAgICAgIHBhcmFtczogewogICAgICAgIG1lc3NhZ2VUeXBlOiAnVm9pY2VNYWlsJywKICAgICAgICBwZXJQYWdlOiBjb3VudAogICAgICB9CiAgICB9KQogICAgcmV0dXJuIHIuZGF0YS5yZWNvcmRzCiAgfSwKICAvKgogIGFzeW5jIHN5bmNWb2ljZU1haWxzIChwYXJhbXMgPSB7CiAgICByZWNvcmRDb3VudDogMTAsCiAgICBzeW5jVHlwZTogJ0ZTeW5jJwogIH0pIHsKICAgIGNvbnN0IHIgPSBhd2FpdCB0aGlzLnJjLmdldCgnL3Jlc3RhcGkvdjEuMC9hY2NvdW50L34vZXh0ZW5zaW9uL34vbWVzc2FnZS1zeW5jJywgewogICAgICBwYXJhbXM6IHsKICAgICAgICAuLi5wYXJhbXMsCiAgICAgICAgbWVzc2FnZVR5cGU6ICdWb2ljZU1haWwnCiAgICAgIH0KICAgIH0pCiAgICByZXR1cm4gci5kYXRhLnJlY29yZHMKICB9LAogICovCiAgYXN5bmMgcHJvY2Vzc1ZvaWNlTWFpbCAobmV3TWFpbENvdW50ID0gMTApIHsKICAgIGlmICghT2JqZWN0LmtleXModGhpcy5ncm91cHMpKSB7CiAgICAgIHJldHVybgogICAgfQogICAgbGV0IHZvaWNlTWFpbHMgPSBhd2FpdCB0aGlzLmdldFZvaWNlTWFpbHMobmV3TWFpbENvdW50KQogICAgbGV0IHVzZXJJZCA9IHRoaXMuaWQKICAgIGxldCBoZWFkZXJzID0gdGhpcy5yYy5fYmVhcmVyQXV0aG9yaXphdGlvbkhlYWRlcigpCiAgICBmb3IgKGxldCBtYWlsIG9mIHZvaWNlTWFpbHMpIHsKICAgICAgbGV0IG1zZyA9IGF3YWl0IHByb2Nlc3NNYWlsKG1haWwsIGhlYWRlcnMpCiAgICAgIGF3YWl0IHRoaXMuc2VuZFZvaWNlTWFpbEluZm8oCiAgICAgICAgcmVzdWx0Rm9ybWF0dGVyKHVzZXJJZCwgbXNnIHx8IHt9KQogICAgICApCiAgICB9CiAgfSwKICBhc3luYyBzZW5kVm9pY2VNYWlsSW5mbyAocHJvY2Vzc2VkTWFpbEluZm8gPSAnJykgewogICAgZm9yIChjb25zdCBncm91cElkIG9mIE9iamVjdC5rZXlzKHRoaXMuZ3JvdXBzKSkgewogICAgICBjb25zdCBib3RJZCA9IHRoaXMuZ3JvdXBzW2dyb3VwSWRdCiAgICAgIGNvbnN0IGJvdCA9IGF3YWl0IHN0b3JlLmdldEJvdChib3RJZCkKICAgICAgYXdhaXQgYm90LnNlbmRNZXNzYWdlKAogICAgICAgIGdyb3VwSWQsCiAgICAgICAgeyB0ZXh0OiBwcm9jZXNzZWRNYWlsSW5mbyB9CiAgICAgICkKICAgIH0KICB9Cn0pCgovKioKICogY3JlYXRlIGluc3RhbmNlIGZyb20gdXNlci9ib3QgaW5mbwogKiBAcGFyYW0ge29iamVjdH0gaXRlbQogKiBAcGFyYW0geyp9IHR5cGUgCiAqLwphc3luYyBmdW5jdGlvbiBjcmVhdGUoaXRlbSwgdHlwZSkgewogIGxldCBkaWN0ID0gewogICAgYm90OiBCb3QsCiAgICB1c2VyOiBVc2VyCiAgfQogIGxldCBpbnN0ID0gbmV3IGRpY3RbdHlwZV0oaXRlbSkKICByZXR1cm4gaW5zdAp9Cg==</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/bot-webhook.js" data-mode="javascript">LyoqCiAqIHVzZXIgb2F1dGggYnkgdHlsZXIKICovCgppbXBvcnQgeyByZXN1bHQgfSBmcm9tICcuL2NvbW1vbicKaW1wb3J0IHsgVXNlciwgc3RvcmUgfSBmcm9tICcuL3N0b3JlJwoKZXhwb3J0IGRlZmF1bHQgYXN5bmMgKGV2ZW50KSA9PiB7CiAgY29uc3QgbWVzc2FnZSA9IGV2ZW50LmJvZHkKICBsZXQgeyBib2R5IH0gPSBtZXNzYWdlCiAgbGV0IG1zZyA9IHJlc3VsdCgnYm90IFdlYkhvb2sgcmVwbGllZCcsIDIwMCwgewogICAgaGVhZGVyczogewogICAgICAndmFsaWRhdGlvbi10b2tlbic6IGV2ZW50LmhlYWRlcnNbJ3ZhbGlkYXRpb24tdG9rZW4nXSB8fCBldmVudC5oZWFkZXJzWydWYWxpZGF0aW9uLVRva2VuJ10KICAgIH0KICB9KQogIGlmICghYm9keSkgewogICAgcmV0dXJuIG1zZwogIH0KCiAgbGV0IGJvdElkID0gbWVzc2FnZS5vd25lcklkCgogIC8vIGhhbmRsZSBleHBpcmUgcmVtaW5kZXIgZXZlbnQsIHJlc3Vic2NyaWJlCiAgLy8gaWYgKG1lc3NhZ2UuZXZlbnQgPT09IHN1YnNjcmliZUludGVydmFsKCkpIHsKICAvLyAgIGxldCBib3QxID0gYXdhaXQgc3RvcmUuZ2V0Qm90KGJvdElkKQogIC8vICAgaWYgKGJvdDEpIHsKICAvLyAgICAgYXdhaXQgYm90MS5yZW5ld1dlYkhvb2tzKCkKICAvLyAgIH0KICAvLyAgIHJldHVybiBtc2cKICAvLyB9CgogIHN3aXRjaCAoYm9keS5ldmVudFR5cGUpIHsKICAgIC8vIGJvdCBqb2luIGdyb3VwCiAgICBjYXNlICdHcm91cEpvaW5lZCc6CiAgICAgIGlmIChib2R5LnR5cGUgPT09ICdQcml2YXRlQ2hhdCcpIHsKICAgICAgICBjb25zdCBib3QgPSBhd2FpdCBzdG9yZS5nZXRCb3QoYm90SWQpCiAgICAgICAgaWYgKCFib3QpIHsKICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICAgIGF3YWl0IGJvdC5zZW5kTWVzc2FnZSgKICAgICAgICAgIGJvZHkuaWQsCiAgICAgICAgICB7CiAgICAgICAgICAgIHRleHQ6IGBIZWxsbywgSSBhbSBhIGNoYXRib3QuClBsZWFzZSByZXBseSAiIVs6UGVyc29uXSgke2JvdElkfSkiIGlmIHlvdSB3YW50IHRvIHRhbGsgdG8gbWUuYAogICAgICAgICAgfQogICAgICAgICkKICAgICAgfQogICAgICBicmVhawoKICAgIC8vIGJvdCBnb3QgcG9zdAogICAgY2FzZSAnUG9zdEFkZGVkJzoKCiAgICAgIC8vIG9ubHkgcmVzcG9uZCB0byBAYm90IGV2ZW50CiAgICAgIGlmIChib2R5LmNyZWF0b3JJZCA9PT0gYm90SWQgfHwgYm9keS50ZXh0LmluZGV4T2YoYCFbOlBlcnNvbl0oJHtib3RJZH0pYCkgPT09IC0xKSB7CiAgICAgICAgYnJlYWsKICAgICAgfQogICAgICB2YXIgYm90ID0gYXdhaXQgc3RvcmUuZ2V0Qm90KGJvdElkKQoKICAgICAgLy8gbm8gYm90IGluIGRhdGFiYXNlCiAgICAgIGlmICghYm90KSB7CiAgICAgICAgYnJlYWsKICAgICAgfQoKICAgICAgLy8gdXNlciB1bm1vbml0IHZvaWNlbWFpbCwKICAgICAgLy8gdG9kbzogdW5jb21tZW50IGNvZGUgaW5zaWRlIGlmIHN0YXRlbWVudCBiZWxvdyB0byBzdXBwb3J0IHVubW9uaXRvciBjb21tYW5kCiAgICAgIGlmICgvXGJ1bm1vbml0b3JcYi9pLnRlc3QoYm9keS50ZXh0KSkgewogICAgICAgIC8vIGNvbnN0IHVzZXIgPSBhd2FpdCBzdG9yZS5nZXRVc2VyKGJvZHkuY3JlYXRvcklkKQogICAgICAgIC8vIGlmICh1c2VyKSB7CiAgICAgICAgLy8gICBhd2FpdCB1c2VyLnJlbW92ZUdyb3VwKGJvZHkuZ3JvdXBJZCkKICAgICAgICAvLyAgIGF3YWl0IGJvdC5zZW5kTWVzc2FnZShib2R5Lmdyb3VwSWQsIHsgdGV4dDogYCFbOlBlcnNvbl0oJHtib2R5LmNyZWF0b3JJZH0pLCBzdG9wcGVkIG1vbml0b3JpbmcgeW91ciB2b2ljZW1haWwhXG5JZiB5b3Ugd2FudCBtZSB0byBtb25pdG9yIHlvdXIgdm9pY2VtYWlsIGFnYWluLCBwbGVhc2UgcmVwbHkgIiFbOlBlcnNvbl0oJHtib3RJZH0pIG1vbml0b3IiYCB9KQogICAgICAgIC8vIH0gZWxzZSB7CiAgICAgICAgLy8gICBhd2FpdCBib3Quc2VuZE1lc3NhZ2UoYm9keS5ncm91cElkLCB7CiAgICAgICAgLy8gICAgIHRleHQ6IGAhWzpQZXJzb25dKCR7Ym9keS5jcmVhdG9ySWR9KSwgSWYgeW91IHdhbnQgbWUgdG8gbW9uaXRvciB5b3VyIHZvaWNlbWFpbCwgcGxlYXNlIHJlcGx5ICIhWzpQZXJzb25dKCR7Ym90SWR9KSBtb25pdG9yIiBmaXJzdC5gCiAgICAgICAgLy8gICB9KQogICAgICAgIC8vIH0KICAgICAgfQoKICAgICAgLy8gdXNlciBtb25pdCB2b2ljZW1haWwKICAgICAgZWxzZSBpZiAoL1xibW9uaXRvclxiL2kudGVzdChib2R5LnRleHQpKSB7CiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHN0b3JlLmdldFVzZXIoYm9keS5jcmVhdG9ySWQpCiAgICAgICAgaWYgKHVzZXIpIHsKICAgICAgICAgIGF3YWl0IHVzZXIuYWRkR3JvdXAoYm9keS5ncm91cElkLCBib3RJZCkKICAgICAgICAgIGF3YWl0IGJvdC5zZW5kTWVzc2FnZShib2R5Lmdyb3VwSWQsIHsgdGV4dDogYCFbOlBlcnNvbl0oJHtib2R5LmNyZWF0b3JJZH0pLCBub3cgeW91ciB2b2ljZW1haWwgaXMgbW9uaXRvcmVkIVxuSWYgeW91IHdhbnQgbWUgdG8gKipzdG9wIG1vbml0b3IqKiB5b3VyIHZvaWNlbWFpbCwgcGxlYXNlIHJlcGx5ICIhWzpQZXJzb25dKCR7Ym90SWR9KSB1bm1vbml0b3IiYCB9KQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCB1c2VyID0gbmV3IFVzZXIoKQogICAgICAgICAgY29uc3QgYXV0aG9yaXplVXJpID0gdXNlci5hdXRob3JpemVVcmkoYm9keS5ncm91cElkLCBib3RJZCkKICAgICAgICAgIGF3YWl0IGJvdC5zZW5kTWVzc2FnZShib2R5Lmdyb3VwSWQsIHsKICAgICAgICAgICAgdGV4dDogYCFbOlBlcnNvbl0oJHtib2R5LmNyZWF0b3JJZH0pLCBbY2xpY2sgaGVyZV0oJHthdXRob3JpemVVcml9KSB0byBhdXRob3JpemUgbWUgdG8gYWNjZXNzIHlvdXIgUmluZ0NlbnRyYWwgZGF0YSBmaXJzdC5gCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gdG9kbzogd3JpdGUgc29tZSBjb2RlIHRvIHN1cHBvcnQgYGhlbHBgIGNvbW1hbmQKCiAgICAgIC8vIG90aGVyIHNpdHVhdGlvbiwganVzdCB0aXAgdXNlciB0byBtb25pdAogICAgICBlbHNlIHsKICAgICAgICBhd2FpdCBib3Quc2VuZE1lc3NhZ2UoYm9keS5ncm91cElkLCB7CiAgICAgICAgICB0ZXh0OiBgSWYgeW91IHdhbnQgbWUgdG8gbW9uaXRvciB5b3VyIHZvaWNlbWFpbCwgcGxlYXNlIHJlcGx5ICIhWzpQZXJzb25dKCR7Ym90SWR9KSBtb25pdG9yImAKICAgICAgICB9KQogICAgICB9CiAgICAgIGJyZWFrCiAgICBkZWZhdWx0OgogICAgICBicmVhawogIH0KCiAgcmV0dXJuIG1zZwp9Cg==</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/user-oauth.js" data-mode="javascript">LyoqCiAqIHVzZXIgb2F1dGggYnkgdHlsZXIKICovCgppbXBvcnQge3Jlc3VsdH0gZnJvbSAnLi9jb21tb24nCmltcG9ydCB7VXNlciwgc3RvcmV9IGZyb20gJy4vc3RvcmUnCgpleHBvcnQgZGVmYXVsdCBhc3luYyAoZXZlbnQpID0+IHsKICBjb25zdCB1c2VyID0gbmV3IFVzZXIoKQogIGF3YWl0IHVzZXIuYXV0aG9yaXplKGV2ZW50LnF1ZXJ5U3RyaW5nUGFyYW1ldGVycy5jb2RlKQogIGNvbnN0IFtncm91cElkLCBib3RJZF0gPSBldmVudC5xdWVyeVN0cmluZ1BhcmFtZXRlcnMuc3RhdGUuc3BsaXQoJzonKQogIGNvbnN0IGJvdCA9IGF3YWl0IHN0b3JlLmdldEJvdChib3RJZCkKCiAgYXdhaXQgYm90LnNlbmRNZXNzYWdlKGdyb3VwSWQsIHsgdGV4dDogYCFbOlBlcnNvbl0oJHt1c2VyLnRva2VuLm93bmVyX2lkfSksIHlvdSBoYXZlIHN1Y2Nlc3NmdWxseSBhdXRob3JpemVkIG1lIHRvIGFjY2VzcyB5b3VyIFJpbmdDZW50cmFsIGRhdGEhYCB9KQoKICBhd2FpdCB1c2VyLmFkZEdyb3VwKGdyb3VwSWQsIGJvdElkKQogIGF3YWl0IGJvdC5zZW5kTWVzc2FnZShncm91cElkLCB7IHRleHQ6IGAhWzpQZXJzb25dKCR7dXNlci50b2tlbi5vd25lcl9pZH0pLCB5b3VyIHZvaWNlTWFpbCBpcyBtb25pdG9yZWQhXG5JZiB5b3Ugd2FudCBtZSB0byAqKnN0b3AgbW9uaXRvcioqIHlvdXIgdm9pY2VtYWlsLCBwbGVhc2UgcmVwbHkgIiFbOlBlcnNvbl0oJHtib3RJZH0pIHVubW9uaXRvciJgIH0pCgogIHJldHVybiByZXN1bHQoCiAgICAnWW91IGhhdmUgYXV0aG9yaXplZCB0aGUgYm90IHRvIGFjY2VzcyB5b3VyIFJpbmdDZW50cmFsIGRhdGEhIFBsZWFzZSBjbG9zZSB0aGlzIHBhZ2UgYW5kIGdldCBiYWNrIHRvIEdsaXAnCiAgKQp9Cg==</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/user-webhook.js" data-mode="javascript">LyoqCiAqIHVzZXIgb2F1dGggYnkgdHlsZXIKICovCgppbXBvcnQge3Jlc3VsdCwgc3Vic2NyaWJlSW50ZXJ2YWwsIHNob3VsZFN5bmNWb2ljZU1haWx9IGZyb20gJy4vY29tbW9uJwppbXBvcnQge3N0b3JlfSBmcm9tICcuL3N0b3JlJwppbXBvcnQgXyBmcm9tICdsb2Rhc2gnCgpleHBvcnQgZGVmYXVsdCBhc3luYyAoZXZlbnQpID0+IHsKICBsZXQgbWVzc2FnZSA9IGV2ZW50LmJvZHkKICBsZXQgbmV3TWFpbENvdW50ID0gc2hvdWxkU3luY1ZvaWNlTWFpbChldmVudCkKICBsZXQgaXNSZW5ld0V2ZW50ID0gXy5nZXQobWVzc2FnZSwgJ2V2ZW50JykgPT09IHN1YnNjcmliZUludGVydmFsKCkKICBpZiAobmV3TWFpbENvdW50IHx8IGlzUmVuZXdFdmVudCkgewogICAgY29uc3QgdXNlcklkID0gKG1lc3NhZ2UuYm9keS5leHRlbnNpb25JZCB8fCBtZXNzYWdlLm93bmVySWQpLnRvU3RyaW5nKCkKICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBzdG9yZS5nZXRVc2VyKHVzZXJJZCkKCiAgICAvLyBnZXQgcmVtaW5kZXIgZXZlbnQsIGRvIHRva2VuIHJlbmV3IGFuZCBzdWJzY3JpYmUgcmVuZXcKICAgIGlmICh1c2VyICYmIGlzUmVuZXdFdmVudCkgewogICAgICBhd2FpdCB1c2VyLnJlbmV3V2ViSG9va3MoKQogICAgICBhd2FpdCB1c2VyLnJlZnJlc2goKQogICAgfQoKICAgIC8vIGdldCBuZXcgdm9pY2VtYWlsLCBwcm9jZXNzIHRoZSBlbWFpbCBhbmQgc2VuZCB0byBjaGF0IGdyb3VwCiAgICAvLyB0b2RvOiBjb21tZW50IG91dCBsaW5lMjYtMjgsIHVuY29tbWVudCBsaW5lMzEtNDAKICAgIC8vIHRvZG86IHJlcGxhY2UgbGluZTI2LTI4LCB1c2UgeW91IG93biBwcm9jZXNzIGZ1bmN0aW9uLCBzZW5kIHNvbWUgY3VzdG9tIHJlcG9uc2UgYWJvdXQgbmV3IHZvaWNlIG1haWwKICAgIGVsc2UgaWYgKHVzZXIpIHsKICAgICAgYXdhaXQgdXNlci5wcm9jZXNzVm9pY2VNYWlsKG5ld01haWxDb3VudCkKICAgIH0KCiAgICAvLyByZXBsYWNlIGxpbmUzNC0zNiB3aXRoIHRoaXMgc2VjdGlvbiwgd2hpY2ggd2lsbCBvbmx5IHRlbGwgY2hhdCBncm91cCBob3cgbWFueSBuZXcgdm9pY2VtYWlsIHdlIGdldAogICAgLy8gZWxzZSBpZiAodXNlcikgewogICAgLy8gICBmb3IgKGNvbnN0IGdyb3VwSWQgb2YgT2JqZWN0LmtleXModXNlci5ncm91cHMpKSB7CiAgICAvLyAgICAgY29uc3QgYm90SWQgPSB1c2VyLmdyb3Vwc1tncm91cElkXQogICAgLy8gICAgIGNvbnN0IGJvdCA9IGF3YWl0IHN0b3JlLmdldEJvdChib3RJZCkKICAgIC8vICAgICBhd2FpdCBib3Quc2VuZE1lc3NhZ2UoCiAgICAvLyAgICAgICBncm91cElkLAogICAgLy8gICAgICAgeyB0ZXh0OiBgIVs6UGVyc29uXSgke3VzZXJJZH0pLCB5b3UgZ290ICR7bmV3TWFpbENvdW50fSBuZXcgdm9pY2VNYWlsISBgfQogICAgLy8gICAgICkKICAgIC8vICAgfQogICAgLy8gfQoKICB9CiAgcmV0dXJuIHJlc3VsdCgnV2ViSG9vayBnb3QnLCAyMDAsIHsKICAgIGhlYWRlcnM6IHsKICAgICAgJ3ZhbGlkYXRpb24tdG9rZW4nOiBldmVudC5oZWFkZXJzWyd2YWxpZGF0aW9uLXRva2VuJ10gfHwgZXZlbnQuaGVhZGVyc1snVmFsaWRhdGlvbi1Ub2tlbiddCiAgICB9CiAgfSkKfQo=</textarea>
<textarea class="saurus-file" data-file="../src/lamda/lib/voicemail-process.js" data-mode="javascript">LyoqCiAqIHJlYWQgdm9pY2VtYWlsIGFuZCBwcm9jZXNzIGl0CiAqLwoKaW1wb3J0IF8gZnJvbSAnbG9kYXNoJwppbXBvcnQge3N0b3JlfSBmcm9tICcuL3N0b3JlJwppbXBvcnQge2xvZ30gZnJvbSAnLi9jb21tb24nCmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJwoKY29uc3QgewogIEdPT0dMRV9BUFBMSUNBVElPTl9DUkVERU5USUFMUwp9ID0gcHJvY2Vzcy5lbnYKCi8vZmFrZSB0cmFuc2NyaXB0IGZvciBkZW1vCmxldCBzcGVlY2gydGV4dCA9ICgpID0+IHsKICByZXR1cm4gJ1RoaXMgaXMgZmFrZSB0cmFuc2NyaXB0IHRleHQgcmVzdWx0IGZvciBkZW1vLCB5b3UgY291bGQgc2V0IEdPT0dMRV9BUFBMSUNBVElPTl9DUkVERU5USUFMUyBpbiAuZW52IHRvIHVzZSByZWFsIGdvb2dsZSBzZXJ2aWNlLicKfQoKLy9mYWtlIHRyYW5zY3JpcHQgZm9yIGRlbW8KbGV0IHRleHRBbmFseXNpcyA9ICgpID0+IHsKICByZXR1cm4gSlNPTi5wYXJzZSgneyJ0ZXh0IjoiVGhpcyBpcyBmYWtlIHRyYW5zY3JpcHQgdGV4dCByZXN1bHQgZm9yIGRlbW8sIHlvdSBjb3VsZCBzZXQgR09PR0xFX0FQUExJQ0FUSU9OX0NSRURFTlRJQUxTIGluIC5lbnYgdG8gdXNlIHJlYWwgZ29vZ2xlIHNlcnZpY2UuIiwic2VudGltZW50Ijp7Im1hZ25pdHVkZSI6MCwic2NvcmUiOjB9LCJzeW50YXgiOnsic2VudGVuY2VzIjpbeyJ0ZXh0Ijp7ImNvbnRlbnQiOiJ0aGlzIGlzIHVyZ2VudCBwbGVhc2UiLCJiZWdpbk9mZnNldCI6LTF9LCJzZW50aW1lbnQiOm51bGx9XSwidG9rZW5zIjpbeyJ0ZXh0Ijp7ImNvbnRlbnQiOiJ0aGlzIiwiYmVnaW5PZmZzZXQiOi0xfSwicGFydE9mU3BlZWNoIjp7InRhZyI6IkRFVCIsImFzcGVjdCI6IkFTUEVDVF9VTktOT1dOIiwiY2FzZSI6IkNBU0VfVU5LTk9XTiIsImZvcm0iOiJGT1JNX1VOS05PV04iLCJnZW5kZXIiOiJHRU5ERVJfVU5LTk9XTiIsIm1vb2QiOiJNT09EX1VOS05PV04iLCJudW1iZXIiOiJTSU5HVUxBUiIsInBlcnNvbiI6IlBFUlNPTl9VTktOT1dOIiwicHJvcGVyIjoiUFJPUEVSX1VOS05PV04iLCJyZWNpcHJvY2l0eSI6IlJFQ0lQUk9DSVRZX1VOS05PV04iLCJ0ZW5zZSI6IlRFTlNFX1VOS05PV04iLCJ2b2ljZSI6IlZPSUNFX1VOS05PV04ifSwiZGVwZW5kZW5jeUVkZ2UiOnsiaGVhZFRva2VuSW5kZXgiOjEsImxhYmVsIjoiTlNVQkoifSwibGVtbWEiOiJ0aGlzIn0seyJ0ZXh0Ijp7ImNvbnRlbnQiOiJpcyIsImJlZ2luT2Zmc2V0IjotMX0sInBhcnRPZlNwZWVjaCI6eyJ0YWciOiJWRVJCIiwiYXNwZWN0IjoiQVNQRUNUX1VOS05PV04iLCJjYXNlIjoiQ0FTRV9VTktOT1dOIiwiZm9ybSI6IkZPUk1fVU5LTk9XTiIsImdlbmRlciI6IkdFTkRFUl9VTktOT1dOIiwibW9vZCI6IklORElDQVRJVkUiLCJudW1iZXIiOiJTSU5HVUxBUiIsInBlcnNvbiI6IlRISVJEIiwicHJvcGVyIjoiUFJPUEVSX1VOS05PV04iLCJyZWNpcHJvY2l0eSI6IlJFQ0lQUk9DSVRZX1VOS05PV04iLCJ0ZW5zZSI6IlBSRVNFTlQiLCJ2b2ljZSI6IlZPSUNFX1VOS05PV04ifSwiZGVwZW5kZW5jeUVkZ2UiOnsiaGVhZFRva2VuSW5kZXgiOjEsImxhYmVsIjoiUk9PVCJ9LCJsZW1tYSI6ImJlIn0seyJ0ZXh0Ijp7ImNvbnRlbnQiOiJ1cmdlbnQiLCJiZWdpbk9mZnNldCI6LTF9LCJwYXJ0T2ZTcGVlY2giOnsidGFnIjoiQURKIiwiYXNwZWN0IjoiQVNQRUNUX1VOS05PV04iLCJjYXNlIjoiQ0FTRV9VTktOT1dOIiwiZm9ybSI6IkZPUk1fVU5LTk9XTiIsImdlbmRlciI6IkdFTkRFUl9VTktOT1dOIiwibW9vZCI6Ik1PT0RfVU5LTk9XTiIsIm51bWJlciI6Ik5VTUJFUl9VTktOT1dOIiwicGVyc29uIjoiUEVSU09OX1VOS05PV04iLCJwcm9wZXIiOiJQUk9QRVJfVU5LTk9XTiIsInJlY2lwcm9jaXR5IjoiUkVDSVBST0NJVFlfVU5LTk9XTiIsInRlbnNlIjoiVEVOU0VfVU5LTk9XTiIsInZvaWNlIjoiVk9JQ0VfVU5LTk9XTiJ9LCJkZXBlbmRlbmN5RWRnZSI6eyJoZWFkVG9rZW5JbmRleCI6MSwibGFiZWwiOiJBQ09NUCJ9LCJsZW1tYSI6InVyZ2VudCJ9LHsidGV4dCI6eyJjb250ZW50IjoicGxlYXNlIiwiYmVnaW5PZmZzZXQiOi0xfSwicGFydE9mU3BlZWNoIjp7InRhZyI6IlgiLCJhc3BlY3QiOiJBU1BFQ1RfVU5LTk9XTiIsImNhc2UiOiJDQVNFX1VOS05PV04iLCJmb3JtIjoiRk9STV9VTktOT1dOIiwiZ2VuZGVyIjoiR0VOREVSX1VOS05PV04iLCJtb29kIjoiTU9PRF9VTktOT1dOIiwibnVtYmVyIjoiTlVNQkVSX1VOS05PV04iLCJwZXJzb24iOiJQRVJTT05fVU5LTk9XTiIsInByb3BlciI6IlBST1BFUl9VTktOT1dOIiwicmVjaXByb2NpdHkiOiJSRUNJUFJPQ0lUWV9VTktOT1dOIiwidGVuc2UiOiJURU5TRV9VTktOT1dOIiwidm9pY2UiOiJWT0lDRV9VTktOT1dOIn0sImRlcGVuZGVuY3lFZGdlIjp7ImhlYWRUb2tlbkluZGV4IjoxLCJsYWJlbCI6IkRJU0NPVVJTRSJ9LCJsZW1tYSI6InBsZWFzZSJ9XSwibGFuZ3VhZ2UiOiJlbiJ9LCJlbnRpdHlTZW50aW1lbnRzIjpbXX0nKQp9CgovL2lmIHNldCBHT09HTEVfQVBQTElDQVRJT05fQ1JFREVOVElBTFMsIHVzZSBnb29nbGUgc2VydmljZQppZiAoR09PR0xFX0FQUExJQ0FUSU9OX0NSRURFTlRJQUxTKSB7CiAgc3BlZWNoMnRleHQgPSByZXF1aXJlKCdhdWRpby1hbmFseXNpcy1zZXJ2aWNlL2Rpc3QvdXJsMnRleHQnKS5zcGVlY2gydGV4dAogIHRleHRBbmFseXNpcyA9IHJlcXVpcmUoJ2F1ZGlvLWFuYWx5c2lzLXNlcnZpY2UvZGlzdC90ZXh0LWFuYWx5c2lzJykudGV4dEFuYWx5c2lzCn0gZWxzZSB7CiAgbG9nKCdubyBHT09HTEVfQVBQTElDQVRJT05fQ1JFREVOVElBTFMgaW4gLmVudiwgc28gdXNlIGZha2UgZGF0YSBmb3IgZGVtbycpCn0KCi8qKgogKiBwcm9jZXNzIHZvaWNlIG1haWwKICogQHBhcmFtIHtvYmplY3R9IG1haWwKICogQHBhcmFtIHtvYmplY3R9IHJjCiAqLwpleHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc01haWwgKG1haWwsIGhlYWRlcnMpIHsKICBsZXQgdXJsID0gXy5nZXQobWFpbCwgJ2F0dGFjaG1lbnRzWzBdLnVyaScpCiAgaWYgKCF1cmwpIHsKICAgIHJldHVybiAnJwogIH0KICBsZXQgbWQ1ID0gY3J5cHRvLmNyZWF0ZUhhc2goJ21kNScpLnVwZGF0ZSh1cmwpLmRpZ2VzdCgnaGV4JykKICBsZXQgY2FjaGVkID0gYXdhaXQgc3RvcmUuZ2V0Q2FjaGUobWQ1KQogIGlmIChjYWNoZWQpIHsKICAgIGxvZygndXNlIGNhY2hlIGZvcicsIHVybCwgbWQ1KQogICAgcmV0dXJuIGNhY2hlZAogIH0KICBsZXQgdGV4dCA9IGF3YWl0IHNwZWVjaDJ0ZXh0KAogICAgdXJsLCBoZWFkZXJzCiAgKQogIGlmICghXy5pc1N0cmluZyh0ZXh0KSkgewogICAgcmV0dXJuICcnCiAgfQogIGxldCByZXN1bHQgPSBhd2FpdCB0ZXh0QW5hbHlzaXModGV4dCkKICBpZiAoIXJlc3VsdCB8fCAhcmVzdWx0LnRleHQpIHsKICAgIHJldHVybiAnJwogIH0KICBhd2FpdCBzdG9yZS5hZGRDYWNoZSh7CiAgICBpZDogbWQ1LAogICAgcmVzdWx0CiAgfSkKICByZXR1cm4gcmVzdWx0Cn0K</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><div class="saurus-file-actions"><a href="https://github.com/ringcentral-tutorials/ringcentral-ai-bot" target="_blank" class="explorer-get-code"><i class="fa fa-lg fa-github-square"></i>View Code on GitHub</a><a href="https://github.com/ringcentral-tutorials/ringcentral-ai-bot/archive/master.zip" target="_blank" class="explorer-get-code"><i class="fa fa-lg icon-download"></i>Download Source Code</a></div></div></div></div><footer><div class="footer-content"><div class="footer-content-row layout-2-cols"><div class="footer-content-row-left"><div class="footer-logo"><a href="http://www.ringcentral.com"><span>Back to the main site</span></a></div></div><div class="footer-content-row-right"><ul class="footer-text-links"><li><a href="http://www.ringcentral.com/legal.html" target="_blank"><span>Legal</span></a></li><li><a href="http://www.ringcentral.com/security-statement.html" target="_blank"><span>Security Policy</span></a></li><li><a href="http://www.ringcentral.com/legal/privacy-policy.html" target="_blank"><span>Privacy Policy</span></a></li><li><a ng-href="https://devcommunity.ringcentral.com" target="_blank" href="https://devcommunity.ringcentral.com"><span>Community</span></a></li><li><a href="https://medium.com/ringcentral-developers" target="_blank"><span>Blog</span></a></li></ul></div></div><div class="footer-content-row footer-content-row-last layout-2-cols"><div class="footer-content-row-left"><span class="footer-copyright">© 1999-<span ng-bind="::main.nowObj|date:'yyyy'" class="footer-copyright-to ng-binding">2017</span> RingCentral, Inc. All rights reserved.</span></div><div class="footer-content-row-right"><div class="footer-image-links"><div class="footer-image-link footer-image-link-facebook"><a target="_blank" href="http://www.facebook.com/ringcentral"><i class="fa icon-facebook"></i></a></div><div class="footer-image-link footer-image-link-twitter"><a target="_blank" href="http://twitter.com/ringcentraldevs"><i class="fa icon-twitter"></i></a></div><div class="footer-image-link footer-image-link-google-plus"><a target="_blank" href="https://www.google.com/+ringcentral"><i class="fa icon-google_plus"></i></a></div><div class="footer-image-link footer-image-link-linkedin"><a target="_blank" href="http://www.linkedin.com/company/ringcentral"><i class="fa icon-linkedin"></i></a></div><div class="footer-image-link footer-image-link-youtube"><a target="_blank" href="http://www.youtube.com/ringcentral"><i class="fa icon-youtube"></i></a></div></div></div></div></div></footer></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script><script>window.tutorialName="Building a RingCentral AI Chatbot";</script><script src="viewsaurus.js"></script></body></html>